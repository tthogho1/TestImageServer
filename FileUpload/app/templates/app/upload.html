<!DOCTYPE html>
<html lang="ja">
<head>
<meta http-equiv="CONTENT-TYPE" content="text/html; charset=utf-8" />
<script src="/static/app/scripts/jquery-1.10.2.js"></script>
<title>ANALYZE FILE</title>
</head>
<body>
    <h1>ANALYZE IMAGE FILE</h1>
    <form id="upload-file" method="POST" enctype="multipart/form-data">
        <div id="drop-zone" style="border: 1px solid; padding: 30px;">
        <p> drag and drop </p>
        <input type="file" name="file" id="file-input">
    </div>
    </form>
     <button type="button" id="upload-file-btn">analyze</button>
     <button type="button" id="get-vector-btn">get vector</button>
    <h2>upload image</h2>
    <div class="left-column" id="preview" style="float:left"></div>
    <div class="right-column" id="result" style="float:right"></div>
<hr />
<script type="text/javascript">

    var dropZone = document.getElementById('drop-zone');
    var preview = document.getElementById('preview');
    var fileInput = document.getElementById('file-input');

    dropZone.addEventListener('dragover', function(e) {
        e.stopPropagation();
        e.preventDefault();
        this.style.background = '#e1e7f0';
    }, false);

    dropZone.addEventListener('dragleave', function(e) {
        e.stopPropagation();
        e.preventDefault();
        this.style.background = '#ffffff';
    }, false);

    fileInput.addEventListener('change', function () {
        previewFile(this.files[0]);
    });

    dropZone.addEventListener('drop', function(e) {
        e.stopPropagation();
        e.preventDefault();
        this.style.background = '#ffffff'; 
        var files = e.dataTransfer.files;
        if (files.length > 1) return alert('only one file for upload');
        fileInput.files = files;
        previewFile(files[0]);
    }, false);

    function previewFile(file) {
        var fr = new FileReader();
        fr.readAsDataURL(file);
        fr.onload = function() {
            var img = document.createElement('img');
            img.setAttribute('src', fr.result);
            preview.innerHTML = '';
            preview.appendChild(img);
        };
    }
</script>
<script>
    function ajaxPost(url,results,form_data) {
        $.ajax({
                type: 'POST',
                url: url,
                data: form_data,
                dataType:'text',
                contentType: false,
                cache: false,
                processData: false,
                async: false
        }).done((data, textStatus, jqXHR)=>{
                $(results).html(data);
        }).fail((jqXHR, textStatus, errorThrown) => {
                alert("API error " + textStatus);
        });
    }

    $(function () {
        $('#upload-file-btn').click(function () {
            var form_data = new FormData($('#upload-file')[0]);
            var url = '/file_upload/rekognition'; 
            var results = '#result';

            ajaxPost(url,results,form_data);
        });

        $('#get-vector-btn').click(function () {
            var form_data = new FormData($('#upload-file')[0]);
            var url = '/file_upload/getvector'; 
            var results = '#result';

            ajaxPost(url,results,form_data);
        });


    });
</script>
</body >
</html>